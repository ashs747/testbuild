machine:
  python:
    version: 2.7.3
  node:
    version: 0.12.0
dependencies:
  pre:
    - rm -rf ~/.npm/cirrus
    - rm -rf ./node_modules/cirrus
test:
  override:
    - cp app/src/localConfig.js.dist app/src/localConfig.js
    - npm install
    - ./node_modules/bower/bin/bower install
    - ./node_modules/gulp/bin/gulp.js lint
    - ./node_modules/gulp/bin/gulp.js build
deployment:
  elasticbeanstalk:
    branch: develop
    commands:
      - pip install awscli
      - chmod +x ./docker/run.sh
      - ./docker/run.sh deployment $CIRCLE_SHA1 edge

  staging:
    branch: master
    commands:
      - pip install awscli
      - chmod +x ./docker/run.sh
      - ./docker/run.sh deployment $CIRCLE_SHA1 staging
