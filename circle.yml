machine:
  python:
    version: 2.7.3
  node:
    version: 5.0.0
dependencies:
  pre:
    - rm -rf ~/.npm/cirrus
    - rm -rf ./node_modules/cirrus
test:
  override:
    - cp app/src/localConfig.js.dist app/src/localConfig.js
    - npm install --only=dev
    - npm install -g eslint babel-eslint bower gulp
    - npm rebuild node-sass
    - bower install
    - gulp build
deployment:
  nightlies:
    branch: develop
    commands:
      - pip install awscli
      - chmod +x ./docker/run.sh
      - ./docker/run.sh deployment $CIRCLE_SHA1 nightly

  staging:
    branch: /^release-.*/
    commands:
      - pip install awscli
      - chmod +x ./docker/run.sh
      - ./docker/run.sh deployment $CIRCLE_SHA1 staging

  release:
    branch: master
    commands:
      - pip install awscli
      - chmod +x ./docker/run.sh
      - ./docker/run.sh deployment $CIRCLE_SHA1 live
